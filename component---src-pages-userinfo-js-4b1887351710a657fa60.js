(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{249:function(e,t,n){"use strict";n.r(t);n(342);var a=n(9),o=n.n(a),r=(n(48),n(0)),i=n.n(r),s=(n(283),n(259)),l=(n(316),n(272)),c=n.n(l),u=n(257),d=n.n(u),h=n(1),p=n.n(h),f=n(115),m=n.n(f),g=n(264),v=n.n(g),b=(n(269),n(278)),y=function(e){function t(){var t;return(t=e.call(this)||this).handleChange=function(e){var n=e.target.value;t.setState({username:n})},t.handleSubmit=function(e){e.target;console.log(t.state.user);var n=t.state,a=n.auth,o=n.user,r=n.username;t.setState({loading:!0}),c()(s.a+"/api/users/"+o.id,{body:JSON.stringify({username:r}),headers:{Authorization:"Bearer "+a,"Content-Type":"application/json"},method:"PATCH"}).then(function(e){return e.json()}).then(function(e){return t.setState({loading:!1,user:e})}).catch(function(e){window.alert(e),t.setState({loading:!1})})},t.state={loading:!1,user:null,username:"",auth:"",uid:"",address:""},t}o()(t,e);var n=t.prototype;return n.componentDidMount=function(){var e,t=this,n="";if(localStorage.getItem("userinfo")){var a=JSON.parse(localStorage.getItem("userinfo"));e=a.auth.accessToken,n=a.id,this.setState({auth:e,address:a.address,uid:n}),console.log("\n auth: ",e)}c()(s.a+"/api/users/"+n,{headers:{Authorization:"Bearer "+e}}).then(function(e){return e.json()}).then(function(e){t.setState({user:e}),console.log(e)}).catch(window.alert)},n.render=function(){var e=this.props.classes,t=this.state,n=t.auth,a=(t.loading,t.user),o=t.address,r=a&&a.username;return r&&console.log("username:",r),i.a.createElement(b.a,null,i.a.createElement("div",{style:{minHeight:"600px",maxWidth:"700px",wordWrap:"break-word",margin:"auto",marginTop:"100px"}},i.a.createElement(v.a,{className:e.root},i.a.createElement(d.a,{variant:"h5",component:"h3"},"用户名:"),r?i.a.createElement("p",null,r):i.a.createElement("p",null,"'未设置'")),i.a.createElement(v.a,{className:e.root},i.a.createElement(d.a,{variant:"h5",component:"h3"},"地址:"),i.a.createElement(d.a,{type:"body1"},o)),i.a.createElement(v.a,{className:e.root},i.a.createElement(d.a,{variant:"h5",component:"h3"},"api-key:"),i.a.createElement(d.a,{type:"body1"},n.toString()))))},t}(i.a.Component);y.propTypes={classes:p.a.object.isRequired},t.default=m()(function(e){return{root:Object.assign({},e.mixins.gutters(),{paddingTop:2*e.spacing.unit,paddingBottom:2*e.spacing.unit,wordWrap:"break-word",marginTop:"10px",margin:"20px"})}})(y)},259:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a="https://api.binstd.com";a="https://api.binstd.com",console.log("server_url:",a)},267:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a,o=n(292);"undefined"!=typeof window&&(a=new o(window.ethereum||new o.HttpProvider("https://ropsten.infura.io/v3/0045c2ce288a4e649a8f39f3d19446b4")))},269:function(e,t,n){"use strict";n(50);var a=n(9),o=n.n(a),r=n(0),i=n.n(r),s=n(1),l=n.n(s),c=n(75),u=n(314),d=n.n(u),h=n(315),p=n.n(h),f=n(257),m=n.n(f),g=n(258),v=n.n(g),b=n(285),y=n.n(b),w=n(20),E=n(312),S=n.n(E),k=n(311),O=n.n(k),C=n(307),M=n.n(C),j=n(310),x=n.n(j),A=n(313),N=n.n(A),T=n(267),I=n(28),R=n.n(I),D=n(282),z=function(){function e(){this.id=Math.random(),this.uid=void 0,this.username=void 0,this.telephone=void 0,this.address=void 0,this.logintype=void 0,this.verifyed=void 0,this.auth=void 0,this.choossedmenu=void 0}var t=e.prototype;return t.allSet=function(e){e.uid&&(this.uid=e.uid),e.username&&(this.username=e.username),e.telephone&&(this.telephone=e.telephone),e.address&&(this.address=e.address),e.verifyed&&(this.verifyed=e.verifyed),e.logintype&&(this.logintype=e.logintype),e.auth&&(this.auth=e.auth)},t.uidSet=function(e){this.uid=e},t.usernameSet=function(e){this.username=e},t.telephoneSet=function(e){this.telephone=e},t.addressSet=function(e){this.address=e},t.logintypeSet=function(e){this.logintype=e},t.verifyedSet=function(e){this.verifyed=e},t.authSet=function(e){this.auth=e},t.clearAll=function(){this.uid="",this.username="",this.telephone="",this.address="",this.logintype="",this.verifyed="",this.auth=""},R()(e,[{key:"getAllData",get:function(){return{uid:this.uid,username:this.username,telephone:this.telephone,address:this.address,verifyed:this.verifyed,logintype:this.logintype,auth:this.auth}}}]),e}();Object(D.f)(z,{uid:D.k,username:D.k,telephone:D.k,address:D.k,verifyed:D.k,logintype:D.k,auth:D.k,choossedmenu:D.k});var B=new z,J=n(283),P=n(259),L=Object(J.a)(function(e){function t(t){var n;return(n=e.call(this,t)||this).handleProfileMenuOpen=function(e){n.setState({anchorEl:e.currentTarget})},n.handleMenuClose=function(){n.setState({anchorEl:null}),n.handleMobileMenuClose()},n.handleMobileMenuOpen=function(e){n.setState({mobileMoreAnchorEl:e.currentTarget})},n.handleMobileMenuClose=function(){n.setState({mobileMoreAnchorEl:null})},n.handleSignMessage=function(e){var t=e.publicAddress,a=e.nonce,o=e.id;return n.setState({id:o}),new Promise(function(e,n){return window.web3.personal.sign(window.web3.fromUtf8("I am signing: "+a),t,function(a,o){return a?n(a):(console.log("\n signature:",o),e({publicAddress:t,signature:o}))})})},n.handleAuthenticate=function(e){var t=e.publicAddress,n=e.signature;return fetch(P.a+"/api/auth",{body:JSON.stringify({publicAddress:t,signature:n}),headers:{"Content-Type":"application/json"},method:"POST"}).then(function(e){return e.json()})},n.handleLoggedIn=function(e){var t={logintype:"ETH",address:window.web3.eth.accounts[0].toLowerCase(),auth:e,id:n.state.id};B.allSet(t),localStorage.setItem("userinfo",JSON.stringify(t)),console.log(B.logintype),n.setState({auth:e}),window.location.reload(!0)},n.handleLoggedOut=function(){localStorage.removeItem("userinfo"),localStorage.removeItem("userdapp"),B.clearAll(),n.setState({auth:void 0}),window.location.reload(!0)},n.handleSignup=function(e){return fetch(P.a+"/api/users",{body:JSON.stringify({publicAddress:e}),headers:{"Content-Type":"application/json"},method:"POST"}).then(function(e){return e.json()})},n.state={userinfo:{},anchorEl:null,mobileMoreAnchorEl:null,network:"",address:""},n}o()(t,e);var n=t.prototype;return n.componentDidMount=function(){var e=this;if(void 0!==window.ethereum&&(this.login(),T.a.net_version().then(function(t){e.setState({networkId:t})}),localStorage.getItem("userinfo"))){var t=JSON.parse(localStorage.getItem("userinfo"));this.setState({userinfo:t})}},n.login=function(){var e=this;void 0!==window.ethereum&&window.ethereum.enable().then(function(t){console.log(t[0]),e.setState({address:t[0]})})},n.payToken=function(){var e=this;B.address||B.logintype||console.log("没有登录"),void 0!==window.ethereum&&window.ethereum.enable().then(function(t){var n=t[0];fetch(P.a+"/api/users?publicAddress="+n).then(function(e){return e.json()}).then(function(t){return t.length?t[0]:e.handleSignup(n)}).then(e.handleSignMessage).then(e.handleAuthenticate).then(e.handleLoggedIn).catch(function(e){window.alert(e)})})},n.render=function(){var e,t=this,n=this.state,a=n.userinfo,o=n.anchorEl,r=n.mobileMoreAnchorEl,s=n.networkId,l=this.props.classes,c=Boolean(o),u=Boolean(r);e="{}"===JSON.stringify(a)?i.a.createElement(v.a,{color:"inherit",onClick:function(){return t.payToken()}}," 登陆 "):i.a.createElement("div",null,i.a.createElement("div",{className:l.sectionDesktop},i.a.createElement(v.a,{color:"inherit",onClick:function(){return Object(w.b)("/dapp/"+a.address)}}," dapp "),i.a.createElement(y.a,{"aria-owns":c?"material-appbar":void 0,"aria-haspopup":"true",onClick:this.handleProfileMenuOpen,color:"inherit"},i.a.createElement(M.a,null))),i.a.createElement("div",{className:l.sectionMobile},i.a.createElement(y.a,{"aria-haspopup":"true",onClick:this.handleMobileMenuOpen,color:"inherit"},i.a.createElement(x.a,null))));var h,f=i.a.createElement(O.a,{anchorEl:o,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:c,onClose:this.handleMenuClose},i.a.createElement(S.a,{onClick:function(){return Object(w.b)("/userinfo")}},"个人中心"),i.a.createElement(S.a,{onClick:function(){return t.handleLoggedOut()}},"退出")),g=i.a.createElement(O.a,{anchorEl:r,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:u,onClose:this.handleMobileMenuClose},i.a.createElement(S.a,{onClick:function(){return Object(w.b)("/userinfo")}},i.a.createElement("p",null,"个人中心")),i.a.createElement(S.a,{onClick:function(){return Object(w.b)("/dapp/"+a.address)}},i.a.createElement("p",null,"我的Dapp")),i.a.createElement(S.a,{onClick:function(){return t.handleLoggedOut()}},i.a.createElement("p",null,"退出"))),b="";switch(s){case"1":b=l.colorMain,h="main";break;case"2":b="",h="morden";break;case"3":b=l.colorRopsten,h="ropsten";break;case"4":b=l.colorRinkeby,h="rinkeby";break;case"42":b=l.colorKovan,h="kovan";break;default:h=" "}var E=i.a.createElement("div",null,i.a.createElement(v.a,{color:"inherit",onClick:function(){return t.login()}},i.a.createElement(N.a,{className:b,style:{fontSize:15,marginRight:"5px"}})," ",h));return i.a.createElement("div",{className:l.root},i.a.createElement(d.a,{position:"fixed",className:l.appBar},i.a.createElement(p.a,null,i.a.createElement("div",{className:l.sectionDesktop},i.a.createElement(y.a,{className:l.menuButton,color:"inherit","aria-label":"Menu"},i.a.createElement("img",{src:"https://programmerinnfile.b0.upaiyun.com/community/10001/20180814/yzdXjjAI4g.png",style:{height:30,width:108,margin:"0 35px 5px 0"}}))),i.a.createElement(m.a,{variant:"h6",color:"inherit",className:l.grow},i.a.createElement(v.a,{color:"inherit",onClick:function(){return Object(w.b)("/")}},"首页"),i.a.createElement(v.a,{color:"inherit",onClick:function(){return Object(w.b)("/imbit")}},"IMbit"),i.a.createElement(v.a,{color:"inherit",onClick:function(){return Object(w.b)("/dapp/index")}},"Dapp部署"),i.a.createElement(v.a,{color:"inherit",onClick:function(){return Object(w.b)("/docs/getting-started/info")}},"API")),i.a.createElement("div",{className:l.sectionDesktop},E),e),f,g))},t}(i.a.Component));L.propTypes={classes:l.a.object.isRequired};t.a=Object(c.withStyles)(function(e){var t,n;return{root:{width:"100%"},appBar:{zIndex:e.zIndex.drawer+1},grow:{flexGrow:1},menuButton:{marginLeft:-12,marginRight:20},sectionDesktop:(t={display:"none"},t[e.breakpoints.up("md")]={display:"flex"},t),sectionMobile:(n={display:"flex"},n[e.breakpoints.up("md")]={display:"none"},n),colorMain:{color:"#1abc9c"},colorRopsten:{color:"#FF3E96"},colorRinkeby:{color:"#FFD700"},colorKovan:{color:"#690496"}}})(L)},272:function(e,t,n){"use strict";var a=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==a)return a;throw new Error("unable to locate global object")}();e.exports=t=a.fetch,t.default=a.fetch.bind(a),t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response},278:function(e,t,n){"use strict";var a=n(0),o=n.n(a),r=n(1),i=n.n(r),s=n(269),l=function(e){var t=e.children;return o.a.createElement("div",null,o.a.createElement(s.a,null),t)};l.propTypes={children:i.a.node.isRequired},t.a=l},289:function(e,t,n){"use strict";var a=n(14);e.exports=function(){var e=a(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},297:function(e,t){},316:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return o});var a=function(e,t){return e[t]?(console.log("jsonData[name].value",e[t].value),e[t].value):t},o=function(e,t,n){return console.log(e,t,n),e[t]&&e[t].inputs&&e[t].inputs[n]?e[t].inputs[n]:n}},342:function(e,t,n){"use strict";n(343);var a=n(14),o=n(289),r=n(21),i=/./.toString,s=function(e){n(22)(RegExp.prototype,"toString",e,!0)};n(35)(function(){return"/a/b"!=i.call({source:"a",flags:"b"})})?s(function(){var e=a(this);return"/".concat(e.source,"/","flags"in e?e.flags:!r&&e instanceof RegExp?o.call(e):void 0)}):"toString"!=i.name&&s(function(){return i.call(this)})},343:function(e,t,n){n(21)&&"g"!=/./g.flags&&n(34).f(RegExp.prototype,"flags",{configurable:!0,get:n(289)})}}]);
//# sourceMappingURL=component---src-pages-userinfo-js-4b1887351710a657fa60.js.map